function dragAndDropSetup(){var e=$("#drop-container");$("#status");"undefined"==typeof window.FileReader&&alert("Sorry. This browser isn't suported"),e.on("dragover",function(){event.preventDefault(),event.stopPropagation(),$(this).addClass("hover")}),e.on("dragleave",function(){event.preventDefault(),event.stopPropagation(),$(this).removeClass("hover")}),e.on("drop",function(e){e.preventDefault(),e.stopPropagation();var t=event.dataTransfer.files;return addDroppedToDOM(t),!1})}function addDroppedToDOM(e){$.each(e,function(e,t){var n=new FileReader;n.onload=function(e){droppedList.append("<li ><img class='dropped-image' src='"+e.target.result+"'></li>"),resizingStation.append("<img class='resize-img' src='"+e.target.result+"'>")}.bind(this),n.readAsDataURL(t)})}function createCanvases(e){var t,n;t=parseInt($("#thumb-width").val()),n=parseInt($("#thumb-height").val()),$(".resize-img").each(function(){var e=new resizeableImage($(this),t,n);allThumbs.push(e)})}function crop(){$.each(allThumbs,function(e,t){t.crop()})}function resizeableImage(e,t,n){var a,o,i=new Image,r={},s=100,c=100,l=1e3,d=1e3,p=0,h=0,u=n,f=t,v=0,g=0,m=document.createElement("canvas"),w=(document.createElement("a"),function(){var e=1;p>h&&u>f?(g=f+15,e=g/h,v=p*e):(v=u+15,e=v/p,g=h*e)}),b=function(){i.src=e[0].src,p=e[0].naturalHeight,h=e[0].naturalWidth,w(),$("<style>.overlay:after,.overlay:before{width:"+f+"px;}.overlay-inner:after,.overlay-inner:before{height:"+u+"px;}</style>").appendTo("head");var r="<div class='overlay' style='height:"+n+"px;width:"+t+"px;margin-left:"+t/2*-1+"px;margin-top:"+n/2*-1+"px;'><div class='overlay-inner'></div></div>";e.wrap('<div class="resize-container" style="height:'+v+"px;width:"+g+'px;"></div>').before('<span class="resize-handle resize-handle-nw"></span>').before('<span class="resize-handle resize-handle-ne"></span>').after('<span class="resize-handle resize-handle-se"></span>').after('<span class="resize-handle resize-handle-sw"></span>'),a=e.parent(".resize-container"),E(a.width(),a.height()),a.wrap('<div class="resize-unit-wrap" style="height:'+2*u+"px;width:"+2*f+'px;"></div>'),a.parent(".resize-unit-wrap").prepend(r),o=a.parent(".resize-unit-wrap").children(".overlay"),a.on("mousedown touchstart",".resize-handle",D),a.on("mousedown",x)}.bind(this),z=function(e){r.evnt=e,r.container_width=a.width(),r.container_height=a.height(),r.container_left=a.offset().left,r.container_top=a.offset().top,r.mouse_x=(e.clientX||e.pageX||e.originalEvent.touches[0].clientX)+$(window).scrollLeft(),r.mouse_y=(e.clientY||e.pageY||e.originalEvent.touches[0].clientY)+$(window).scrollTop()}.bind(this),x=function(e){e.preventDefault(),e.stopPropagation(),z(e),$(document).on("mousemove",y),$(document).on("mouseup",_)}.bind(this),y=function(e){var t={};e.preventDefault(),e.stopPropagation(),t.x=$(window).scrollLeft()+(e.clientX||e.pageX),t.y=$(window).scrollTop()+(e.clientY||e.pageY),a.offset({left:t.x-(r.mouse_x-r.container_left),top:t.y-(r.mouse_y-r.container_top)})}.bind(this),_=function(e){e.preventDefault(),$(document).off("mouseup",_),$(document).off("mousemove",y)}.bind(this),D=function(e){e.preventDefault(),e.stopPropagation(),z(e),$(document).on("mousemove",C),$(document).on("mouseup",T)}.bind(this),T=function(e){e.preventDefault(),$(document).off("mouseup touchend",T),$(document).off("mousemove touchmove",C)}.bind(this),C=function(e){var t,n,o,p,h={};a.offset();h.x=(e.clientX||e.pageX||e.originalEvent.touches[0].clientX)+$(window).scrollLeft(),h.y=(e.clientY||e.pageY||e.originalEvent.touches[0].clientY)+$(window).scrollTop(),$(r.evnt.target).hasClass("resize-handle-se")?(t=h.x-r.container_left,n=t/i.width*i.height,o=r.container_left,p=r.container_top):$(r.evnt.target).hasClass("resize-handle-sw")?(t=r.container_width-(h.x-r.container_left),n=t/i.width*i.height,o=h.x,p=r.container_top):$(r.evnt.target).hasClass("resize-handle-nw")?(t=r.container_width-(h.x-r.container_left),n=t/i.width*i.height,o=h.x,p=h.y-(t/i.width*i.height-n)):$(r.evnt.target).hasClass("resize-handle-ne")&&(t=h.x-r.container_left,n=t/i.width*i.height,o=r.container_left,p=h.y-(t/i.width*i.height-n)),t>s&&n>c&&l>=t&&d>=n&&(E(t,n),a.offset({left:o,top:p}))},E=function(t,n){m.width=t,m.height=n,m.getContext("2d").drawImage(i,0,0,t,n),e.attr("src",m.toDataURL("image/png")),a.attr("style","")}.bind(this);this.crop=function(){var t,n=o.offset().left-a.offset().left,i=o.offset().top-a.offset().top,r=o.width(),s=o.height();t=document.createElement("canvas"),t.width=r,t.height=s,t.getContext("2d").drawImage(e[0],n,i,r,s,0,0,r,s);var c=document.createElement("a");c.addEventListener("click",function(e){c.href=t.toDataURL(),c.download="thumb.png"},!1),c.click()}.bind(this),b()}var allThumbs=[],droppedList=$("#dropped-list"),resizingStation=$("#canvas-container");$(function(){dragAndDropSetup(),$("#continue-bttn").click(function(e){e.preventDefault(),e.stopPropagation(),$(".drag-drop-wrap").fadeOut(500),$(".thumb-factory-wrap").fadeIn(1e3),createCanvases()}),$(".js-crop").on("click",crop)});